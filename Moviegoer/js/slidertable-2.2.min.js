(function()
	{
	var idbase="slideful_20181113_1927389994066877";
	var count=7;
	var slide_current=1;
	var slide_next=1;
	var frozen=0;
	var timeinterval_s=5;
	var timeinterval_first_s=timeinterval_s+0;
	var timer_buttonfreeze=15;
	var action_type;
	var slide_prev;
	var timerid;
	var a,b,c;
	zIndex_current=500;
	var self=this;
	if(frozen) return;


	function button_onclick(nn)
		{
		timer_stop();if(nn==slide_current) {document.getElementById(idbase+'-slide-'+nn).click();return;} display(nn);timer_start(timer_buttonfreeze);
		}
	slideful_button_onclick=button_onclick;
	slideful_20181113_1927389994066877_button_onclick=button_onclick;


	for(n=1;n<=count;n++)
		{
		b=document.getElementById(idbase+'-dot-'+n);
		if(b)
			(function(nn)
			{
			b.onclick=function(){ return button_onclick(nn)}
			})(n)
		}


	if(b=document.getElementById(idbase+'-buttonback'))
		b.onclick=function(){var n=slide_current-1;;if(n<1) n=count;display(n,false,true);timer_start(timer_buttonfreeze)}
	if(b=document.getElementById(idbase+'-buttonforward'))
		b.onclick=function(){var n=slide_current+1;if(n>count) n=1;display(n,false,false);timer_start(timer_buttonfreeze)}


	function start()
		{
		action_type="start"
		this.rotation_time_start_utc_ms=(new Date()).getTime();
		timer_start(0.01)
		}

	function sequencer(n)
		{
		if(n!=null) {timer_stop();display(n);timer_start();this.rotation_time_start_utc_ms=(new Date()).getTime();return;}
		switch(action_type)
			{
			case "start":		display(slide_current,true);
						action_type="usualpass"
						timer_start(timeinterval_first_s)
						break

			case "usualpass":
						b=document.getElementById(idbase+'-image-'+slide_next);
						if(!b.slide_ready)
							{
							if(!b.slide_try_n) b.slide_try_n=1;
							if(b.slide_try_n<3)	b.slide_try_n++;
							else			slide_next=(slide_next>=count)?1:slide_next+1;
							timer_start(timeinterval_s/4);
							return;
							}
						//usual pass
						if(1 || this.contents_ar[slide_next].ready())
							{
							display(slide_next,false,false);
							timer_start()
							}
						else	{
							slide_next++;if(slide_next>count) slide_next=1;
							display(slide_next)
							timer_start()
							}
			}
		}


	function display(n,now,backward)
		{
		//console.debug(n);
		var d=document.getElementById(idbase+'-slide-'+n);
		if(!d) return;
		zIndex_current+=2;
		for(var nn=count;nn>=1;nn--) button_off(nn);
		d.style.zIndex=zIndex_current;
		if(!now) {
				d.style.transition='';
				d.style.opacity=0;
				}
		d.style.visibility="visible";
		button_on(n);
		if(zIndex_current>9000)
			{
			for(var nn=count;nn>=1;nn--) {if(n!=nn) document.getElementById(this.contents_ar[nn].id).style.zIndex-=8500;}
			zIndex_current-=8500;
			d.style.zIndex=zIndex_current;
			}

		if((this.frameimage!=null) && (this.frameimage.src!=null) && (this.contents_ar[slide_next].href!=null))
			document.getElementById(this.frameimage.id+'_a').href=this.contents_ar[slide_next].href
		//console.debug(n+'  '+slide_current);
		if(backward==undefined) backward=n<slide_current;
		slide_current=n;
		slide_next=slide_current+1;if(slide_next>count) slide_next=1;
		if(!now) effect(d,slide_prev,backward);
		slide_prev=d;
		}

	function button_off(n)	{class_delete(document.getElementById(idbase+'-dot-'+n),'-on');class_delete(document.getElementById(idbase+'-arrow-'+n),'-on');}
	function button_on(n)	{class_set(document.getElementById(idbase+'-dot-'+n),'-on');class_set(document.getElementById(idbase+'-arrow-'+n),'-on')}


	function timer_start(timer_s) {timer_stop();timerid=window.setTimeout(sequencer,1000*(timer_s==null?timeinterval_s:timer_s));}
	function timer_stop(){if (timerid) window.clearTimeout(timerid);timerid=null}


	function class_set(obj,clss)
		{
		if(!obj) return;
		class_delete(obj,clss);
		obj.className=String(obj.className)+' '+clss;
		//console.debug(obj.id);
		//console.debug(obj.className);
		}


	function class_delete(obj,clss)
		{
		if(!obj) return;
		obj.className=String(obj.className).replace(new RegExp('(^|\\s)'+clss+'(\\s|$)','g'),'$2');
		}


function effect_csstransition_can()
		{
		if(effect_csstransition_can_var!==undefined) return effect_csstransition_can_var;
		var div = document.createElement('div');
		div.setAttribute('style', 'transition:top 1s ease;display.none;');
		document.body.appendChild(div);
		effect_csstransition_can_var = !!(div.style.transition);
		div.parentNode.removeChild(div);
		div = null;
		return effect_csstransition_can_var;
		}
var effect_csstransition_can_var;

	function effect(obj,prevobj,backward,stage)
		{
		if(!obj) return;
		if(obj===prevobj) return;
		if(effect_csstransition_can())
			{
			var t= 1.5;
			window.setTimeout(function(){
				obj.style.transition='opacity '+ t + 's';
				obj.style.opacity=1;
				},50);
			if(prevobj)
				window.setTimeout(function(){
					prevobj.style.transition='opacity '+ (t/1.5).toFixed(3) + 's';
					prevobj.style.opacity=0;
					},50+t*1000);

			return;
			}


		//console.debug(obj.style.opacity);
		var odelta=0.015;
		var o=(obj.style.opacity?   parseFloat(obj.style.opacity):0) + odelta;
		obj.style.opacity=Math.max(0,Math.min(1,o));
		stage=stage? stage+1:1;
		if(o>=1 && stage<100)
			stage=100;
		if(stage>=100 && stage<200)
				{
				if(prevobj)
					{
					o=(prevobj.style.opacity?   parseFloat(prevobj.style.opacity):1) - odelta*2;
					prevobj.style.opacity=Math.max(0,Math.min(1,o));
					if(o<0) stage=200;
					}
				else
					stage=200;
				}

		if(stage<200)
			window.setTimeout(function()
					{
					effect(obj,prevobj,backward,stage);
					}
					,25					);
		}



	start();

	})();
